#!/usr/bin/env zsh

############################# Basic configuration #############################
# See https://wiki.archlinux.org/title/zsh for details.

# Enable completion.
autoload -Uz compinit promptinit
compinit
promptinit

# Select driven interface.
zstyle ':completion:*' menu select
# Autocomplete aliases.
setopt COMPLETE_ALIASES
# Complete commands start with sudo.
zstyle ':completion::complete:*' gain-privileges 1
# Automatically find executables in $PATH.
zstyle ':completion:*' rehash true
# Autocomplete makefiles targets without expanding files.
zstyle ':completion:*:*:make:*' tag-order 'targets'

# Use tcsh style (default) bindings.
bindkey -e
stty -ixon # unbind Ctrl-s

# History.
# (Source https://github.com/ohmyzsh/ohmyzsh/blob/master/lib/history.zsh)
## History file configuration.
[ -z "$HISTFILE" ] && HISTFILE="$HOME/.zsh-history"
[ "$HISTSIZE" -lt 50000 ] && HISTSIZE=50000
[ "$SAVEHIST" -lt 30000 ] && SAVEHIST=30000

## History command configuration.
setopt extended_history       # record timestamp of command in HISTFILE
setopt hist_expire_dups_first # delete duplicates first when HISTFILE size exceeds HISTSIZE
setopt hist_ignore_dups       # ignore duplicated commands history list
setopt hist_ignore_space      # ignore commands that start with space
setopt hist_verify            # show command with history expansion to user before running it
setopt share_history          # share command history data
setopt interactivecomments    # enable hash comment command

######################### User specific configuration ##########################

s="$HOME/.zsh-theme"; [ -f "$s" ] && . "$s"
s="$HOME/.fzf-projects.zsh"; [ -f "$s" ] && . "$s"

s="/usr/share/fzf/key-bindings.zsh"; [ -f "$s" ] && . "$s"
s="/usr/share/fzf/completion.zsh"; [ -f "$s" ] && . "$s"
s="/usr/share/fzf/key-bindings.zsh"; [ -f "$s" ] && . "$s"
s="/usr/share/zsh/plugins/zsh-autosuggestions/zsh-autosuggestions.plugin.zsh"; [ -f "$s" ] && . "$s"
s="/opt/homebrew/share/zsh-autosuggestions/zsh-autosuggestions.zsh"; [ -f "$s" ] && . "$s"

s="/usr/share/zsh/plugins/zsh-syntax-highlighting/zsh-syntax-highlighting.plugin.zsh"; [ -f "$s" ] && . "$s"
s="/opt/homebrew/share/zsh-syntax-highlighting/zsh-syntax-highlighting.zsh"; [ -f "$s" ] && . "$s"
(( ${+ZSH_HIGHLIGHT_STYLES} )) || typeset -A ZSH_HIGHLIGHT_STYLES
ZSH_HIGHLIGHT_STYLES[path]=none
ZSH_HIGHLIGHT_STYLES[path_prefix]=none

s="/opt/homebrew/opt/fzf/shell/completion.zsh"; [ -f "$s" ] && . "$s"
s="/opt/homebrew/opt/fzf/shell/key-bindings.zsh"; [ -f "$s" ] && . "$s"
s="/opt/homebrew/Caskroom/google-cloud-sdk/latest/google-cloud-sdk/path.zsh.inc"; [ -f "$s" ] && . "$s"

[ -x "$(command -v kubectl)" ] && . <(kubectl completion zsh)

# ------------------------------------------------------------------------------
s="$HOME/.config-common.sh"; [ -f "$s" ] && . "$s"
s="$HOME/.shell-aliases"; [ -d "$s" ] && for f in "$s"/*.sh; do . $f; done
unset s
